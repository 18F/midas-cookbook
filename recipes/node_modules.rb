user node.midas.user do
  supports :manage_home => true
  home node.midas.user_home
end

# update npm
execute 'update npm' do
  command "npm install npm@2.1.x -g"
  cwd node.midas.deploy_dir
  user node.midas.user
end

# install global packages
npm_packages = ['grunt-cli']

npm_packages.each do |np|
  nodejs_npm np
end

# install midas dependencies locally
nodejs_npm 'midas' do
  path node.midas.deploy_dir
  json true
  user node.midas.user
  group node.midas.group
  options ['--production']
end
