var fs = require('fs'),
    pgSession = require('connect-pg-simple'),
    express = require('sails/node_modules/express'),
    pg = require('sails-postgresql/node_modules/pg'),
    local;

local = {
  systemName: '<%= @app_id %>',
  httpProtocol: 'https',
  hostName: '<%= @app_host %>',
  port: process.env.PORT || 1337,
  environment: '<%= @app_environment %>',

  connections: {
    'default': 'postgresql',
    memory: {
      adapter: 'sails-disk',
      inMemory: true
    },
    disk: {
      adapter: 'sails-disk',
      filePath: './.tmp/',
      inMemory: false
    },
    postgresql: {
      adapter     : 'sails-postgresql',
      host        : '<%= @db_host %>',
      user        : '<%= @db_user %>',
      password    : '<%= @db_password %>',
      database    : '<%= @db_name %>',
      softDelete  : true
    }
  },

  emailTemplateDirectories: {
    templateDir: 'assets/email/templates',
    layoutDir: 'assets/email/layouts'
  },

  emailProtocol: 'SMTP',
  smtp: {
    service             : '',
    host                : '<%= @email_host %>',
    secureConnection    : <%= @email_secure %>,
    port                : <%= @email_port %>,
    auth                : {
      user              : '<%= @email_user %>',
      pass              : '<%= @email_password %>'
    },
    ignoreTLS           : false,
    debug               : false,
    maxConnections      : 5
  },

  ses: {
    // AWSAccessKeyID: 'AWSACCESSKEY',
    // AWSSecretKey: 'AWS/Secret/key',
    // ServiceUrl: 'https://email.us-east-1.amazonaws.com'
  },

  dkimEnabled: false,
  dkim: {
    // domainName: "kreata.ee",
    // keySelector: "dkim",
    // privateKey: fs.readFileSync("private_key.pem"),
    // headerFieldNames: ''
  },

  systemEmail: '<%= @app_system_email %>'

};

// Use main postgres database for sessions
local.session = {
  store: new (pgSession(express.session))({
    conString: local.connections.postgresql,
    pg: pg
  })
};

module.exports = local;
